<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Find errors in data • errorlocate</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Find errors in data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">errorlocate</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/errorlocate.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/inspect_mip.html">Inspecting the errorlocate Mixed Integer Program</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/data-cleaning/errorlocate/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Find errors in data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/data-cleaning/errorlocate/blob/master/vignettes/errorlocate.Rmd" class="external-link"><code>vignettes/errorlocate.Rmd</code></a></small>
      <div class="d-none name"><code>errorlocate.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="intro">Intro<a class="anchor" aria-label="anchor" href="#intro"></a>
</h2>
<p>Errorlocate uses validation rules from package <code>validate</code>
to locate faulty values in observations (or in database slang:
erronenous <em>fields</em> in <em>records</em>).</p>
<p>It follows this simple recipe (Felligi-Holt):</p>
<ul>
<li>Check if a record is valid (using supplied validation rules)</li>
<li>If not valid then adjust the minimum number of values to make it
valid.</li>
</ul>
<p><code>errorlocate</code> does this by translating the validation
rules and record values into a mixed integer problem (see
<code>vignette("inspect_mip", package="errorlocate"</code>) and solving
it using the R package <code>lpSolveAPI</code>.</p>
</div>
<div class="section level2">
<h2 id="workflow">Workflow<a class="anchor" aria-label="anchor" href="#workflow"></a>
</h2>
<p>Locating errors is part of a data cleaning workflow, see e.g. <span class="citation">Loo and Jonge (2018)</span>, where after locating
errors, these errors are removed (set to <code>NA</code>) and
subsequently imputed. The input for errorlocate are validation rules,
which can be formulated using package <code>validate</code> <span class="citation">(van der Loo and de Jonge 2019)</span>.</p>
<p>A typical workflow for using <code>errorlocate</code> is:</p>
<ol style="list-style-type: decimal">
<li>Formulate validation rules using
<code><a href="https://rdrr.io/pkg/validate/man/validator.html" class="external-link">validate::validator()</a></code>
</li>
<li>Check which records are invalid using
<code><a href="https://rdrr.io/pkg/validate/man/confront.html" class="external-link">validate::confront()</a></code>
</li>
<li>Use <code><a href="https://rdrr.io/pkg/validate/man/validate-summary.html" class="external-link">validate::summary()</a></code> to get an overview of invalid
records and the rules they violate.</li>
<li>(Optional) Correct obvious data errors which correction rules, for
example using <code>dcmodify::modify</code>
</li>
<li>(Optional) Determine <code>weights</code> for variables, indicating
how likely they are to be faulty. Higher weights indicate more trust in
the variable.</li>
<li>Use <code>locate_errors</code> to find which values are faulty for
the invalid records.</li>
<li>Use <code>replace_errors</code> to set faulty values to
<code>NA</code>.</li>
<li>Use deductive imputation to fill in missing values that follow from
the rules, e.g. <code>deductive::deduImpute()</code>
</li>
<li>Impute the remaining missing values using your favorite imputation
method, e.g. <code>simputation</code>
</li>
<li>(Optional) Re-validate the data using
<code><a href="https://rdrr.io/pkg/validate/man/confront.html" class="external-link">validate::confront()</a></code> to check if all records are now
valid.</li>
</ol>
<p>Post hoc:</p>
<ul>
<li>Analyze the output of <code>locate_errors</code> to get insights in
which variables are more often faulty than others, which can be used to
improve future data collection processes.</li>
</ul>
</div>
<div class="section level2">
<h2 id="main-methods">Main methods<a class="anchor" aria-label="anchor" href="#main-methods"></a>
</h2>
<p><code>errorlocate</code> has two main functions to be used:</p>
<ul>
<li>
<code>locate_errors</code> for detecting errors</li>
<li>
<code>replace_errors</code> for replacing faulty values with
<code>NA</code>
</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/data-cleaning/validate" class="external-link">validate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/data-cleaning/errorlocate" class="external-link">errorlocate</a></span><span class="op">)</span></span></code></pre></div>
<p>Let’s start with a simple example:</p>
<p>We have a rule that age cannot be negative:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/validate/man/validator.html" class="external-link">validator</a></span><span class="op">(</span><span class="va">age</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<p>And we have the following data set</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="st">"age, income</span></span>
<span><span class="st"> -10,    0  </span></span>
<span><span class="st">  15, 2000</span></span>
<span><span class="st">  25, 3000</span></span>
<span><span class="st">  NA, 1000</span></span>
<span><span class="st">"</span> <span class="op">-&gt;</span> <span class="va">csv</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/textconnections.html" class="external-link">textConnection</a></span><span class="op">(</span><span class="va">csv</span><span class="op">)</span>, strip.white <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt;   age income</span></span>
<span><span class="co">#&gt; 1 -10      0</span></span>
<span><span class="co">#&gt; 2  15   2000</span></span>
<span><span class="co">#&gt; 3  25   3000</span></span>
<span><span class="co">#&gt; 4  NA   1000</span></span></code></pre>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">le</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/locate_errors.html">locate_errors</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">rules</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/validate/man/validate-summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">le</span><span class="op">)</span></span>
<span><span class="co">#&gt; Variable:</span></span>
<span><span class="co">#&gt;     name errors missing</span></span>
<span><span class="co">#&gt; 1    age      1       1</span></span>
<span><span class="co">#&gt; 2 income      0       0</span></span>
<span><span class="co">#&gt; Errors per record:</span></span>
<span><span class="co">#&gt;   errors records</span></span>
<span><span class="co">#&gt; 1      0       3</span></span>
<span><span class="co">#&gt; 2      1       1</span></span></code></pre></div>
<p><code>summary(le)</code> gives an overview of the errors found in
this data set. The complete error listing can be found with:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">le</span><span class="op">$</span><span class="va">errors</span></span>
<span><span class="co">#&gt;        age income</span></span>
<span><span class="co">#&gt; [1,]  TRUE  FALSE</span></span>
<span><span class="co">#&gt; [2,] FALSE  FALSE</span></span>
<span><span class="co">#&gt; [3,] FALSE  FALSE</span></span>
<span><span class="co">#&gt; [4,]    NA  FALSE</span></span></code></pre></div>
<p>Which says that record 1 has a faulty value for age.</p>
<p>Suppose we expand our rules</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rules</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/validate/man/validator.html" class="external-link">validator</a></span><span class="op">(</span> r1 <span class="op">=</span> <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span>                  , r2 <span class="op">=</span> <span class="kw">if</span> <span class="op">(</span><span class="va">income</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="va">age</span> <span class="op">&gt;</span> <span class="fl">16</span></span>
<span>                  <span class="op">)</span></span></code></pre></div>
<p>With <code><a href="https://rdrr.io/pkg/validate/man/confront.html" class="external-link">validate::confront</a></code> we can see that rule
<code>r2</code> is violated (record 2).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/validate/man/validate-summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/validate/man/confront.html" class="external-link">confront</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">rules</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   name items passes fails nNA error warning               expression</span></span>
<span><span class="co">#&gt; 1   r1     4      2     1   1 FALSE   FALSE                  age &gt; 0</span></span>
<span><span class="co">#&gt; 2   r2     4      2     1   1 FALSE   FALSE income &lt;= 0 | (age &gt; 16)</span></span></code></pre></div>
<p>What errors will be found by <code>locate_errors</code>?</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">le</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/locate_errors.html">locate_errors</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">rules</span><span class="op">)</span></span>
<span><span class="va">le</span><span class="op">$</span><span class="va">errors</span></span>
<span><span class="co">#&gt;        age income</span></span>
<span><span class="co">#&gt; [1,]  TRUE  FALSE</span></span>
<span><span class="co">#&gt; [2,]  TRUE  FALSE</span></span>
<span><span class="co">#&gt; [3,] FALSE  FALSE</span></span>
<span><span class="co">#&gt; [4,]    NA  FALSE</span></span></code></pre></div>
<p>It now detects that <code>age</code> in observation 2 is also faulty,
since it violates the second rule. Note that we use
<code>set.seed</code>. This is needed because in this example, either
<code>age</code> or <code>income</code> can be considered faulty.
<code>set.seed</code> assures that the procedure is reproducible.</p>
<p>With <code>replace_errors</code> we can remove the errors (which
still need to be imputed).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/replace_errors.html">replace_errors</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">le</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/validate/man/validate-summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/validate/man/confront.html" class="external-link">confront</a></span><span class="op">(</span><span class="va">d_fixed</span>, <span class="va">rules</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   name items passes fails nNA error warning               expression</span></span>
<span><span class="co">#&gt; 1   r1     4      1     0   3 FALSE   FALSE                  age &gt; 0</span></span>
<span><span class="co">#&gt; 2   r2     4      2     0   2 FALSE   FALSE income &lt;= 0 | (age &gt; 16)</span></span></code></pre></div>
<p>In which <code>replace_errors</code> set all faulty values to
<code>NA</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">d_fixed</span></span>
<span><span class="co">#&gt;   age income</span></span>
<span><span class="co">#&gt; 1  NA      0</span></span>
<span><span class="co">#&gt; 2  NA   2000</span></span>
<span><span class="co">#&gt; 3  25   3000</span></span>
<span><span class="co">#&gt; 4  NA   1000</span></span></code></pre></div>
<div class="section level3">
<h3 id="weights">Weights<a class="anchor" aria-label="anchor" href="#weights"></a>
</h3>
<p><code>locate_errors</code> allows for supplying weigths for the
variables. It is common that the quality of the observed variables
differs. When we have more trust in <code>age</code> we can give it more
weight so it chooses income when it has to decide between the two
(record 2):</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="co"># good practice, see later in this document</span></span>
<span><span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>age <span class="op">=</span> <span class="fl">2</span>, income <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> </span>
<span><span class="va">le</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/locate_errors.html">locate_errors</a></span><span class="op">(</span><span class="va">d</span>, <span class="va">rules</span>, <span class="va">weight</span><span class="op">)</span></span>
<span><span class="va">le</span><span class="op">$</span><span class="va">errors</span></span>
<span><span class="co">#&gt;        age income</span></span>
<span><span class="co">#&gt; [1,]  TRUE  FALSE</span></span>
<span><span class="co">#&gt; [2,] FALSE   TRUE</span></span>
<span><span class="co">#&gt; [3,] FALSE  FALSE</span></span>
<span><span class="co">#&gt; [4,]    NA  FALSE</span></span></code></pre></div>
<p>Weights can be specified in different ways: (see also
<code><a href="../reference/expand_weights.html">errorlocate::expand_weights</a></code>):</p>
<ul>
<li>not specifying: all variables will have weight 1</li>
<li>named <code>vector</code>: all records will have same set of
weights. Unspecified columns will have weight 1.</li>
<li>named <code>matrix</code> or <code>data.frame</code>, same dimension
as the data: specify weights per record.</li>
<li>Use <code>Inf</code> weights to fixate a variable, so it won’t be
changed.</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="reproducability-set-seed">Reproducability (<code>set.seed</code>)<a class="anchor" aria-label="anchor" href="#reproducability-set-seed"></a>
</h2>
<p>The error location procedure can have, in some cases, multiple
optimal solutions. For example given the rule:</p>
<ul>
<li><code>if (married == TRUE) age &gt; 16</code></li>
</ul>
<p>and the following data:</p>
<pre><code><span><span class="co">#&gt;   age married</span></span>
<span><span class="co">#&gt; 1   4    TRUE</span></span></code></pre>
<p>Then either <code>age</code> or <code>married</code> can be
considered faulty. When no weights are specified,
<code>locate_errors</code> will randomly choose one of the two. It does
this by adding a small amount of random noise to the weights internally.
To make sure that the results are reproducible, it is good practice to
use <code>set.seed</code> before calling <code>locate_errors</code>.</p>
<p>Note that using <code>set.seed</code> only makes the exact indentical
input reproducible. Whenever the input <code>data.frame</code> have a
different order, different number of rows or columns, the generated
noise for the weights of some of the records will be different. This
level of reproducibility can be achieved by generating the noise
beforehand using <code><a href="../reference/add_noise.html">errorlocate::add_noise</a></code>, storing the
weights together with the records and supplying the noisy weights to
<code>locate_errors</code>.</p>
</div>
<div class="section level2">
<h2 id="performance-parallelisation">Performance / Parallelisation<a class="anchor" aria-label="anchor" href="#performance-parallelisation"></a>
</h2>
<p><code>locate_errors</code> solves a mixed integer problem. When the
number of interactions between validation rules is large, finding an
optimal solution can become computationally intensive. Both
<code>locate_errors</code> as well as <code>replace_errors</code> have a
parallization option: <code>Ncpus</code> making use of multiple
processors. The <code>$duration</code> (s) property of each solution
indicates the time spent to find a solution for each record. This can be
restricted using the argument <code>timeout</code> (s).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># duration is in seconds. </span></span>
<span><span class="va">le</span><span class="op">$</span><span class="va">duration</span></span>
<span><span class="co">#&gt; [1] 0.002073288 0.001595259 0.000000000 0.001464605</span></span></code></pre></div>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-loo2018statistical" class="csl-entry">
Loo, Mark van der, and Edwin de Jonge. 2018. <em>Statistical Data
Cleaning with Applications in </em>. John Wiley &amp; Sons.
</div>
<div id="ref-loo2018validate" class="csl-entry">
van der Loo, Mark, and Edwin de Jonge. 2019. <em>Validate: Data
Validation Infrastructure</em>. <a href="https://CRAN.R-project.org/package=validate" class="external-link">https://CRAN.R-project.org/package=validate</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Edwin de Jonge, Mark van der Loo.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
